# Проєкт Взаємодії з Трембітою. Javascript REST Client

## Опис проекту

Цей проєкт входить в набір прикладів взаємодії з API шлюзу безпечного обміну
системи Трембіта (ШБО), що демонструють технічні особливості розробки
вебсервісів та вебклієнтів, сумісних з системою Трембіта. Даний проєкт описує
створення сумісного REST-клієнта на мові програмування JavaScript з
використанням фреймворків Next.js та React для здійснення викликів REST API
через ШБО. Додатково розглянуто функції API ШБО для завантаження архівів з
підписаними електронними повідомленнями-запитами, повідомленнями-відповідями у
вигляді ASiC-контейнерів, а також генерацію ключів і сертифікатів для взаємної
автентифікації між REST-клієнтом та ШБО.

## Зміст

1. [Опис проекту](#опис-проекту)
2. [Вимоги](#вимоги)
3. [Встановлення](#встановлення)
   - [Ручне встановлення та запуск](#ручне-встановлення-та-запуск)
4. [Конфігурація](#конфігурація)
5. [Структура проєкту](#структура-проєкту)
6. [Використання](#використання)
7. [Документація](#документація)
   - [Опис роутів Next Api](#опис-роутів-next-api)
   - [Логування](#логування)
   - [Обробка помилок](#обробка-помилок)
   - [Залежності](#залежності)
   - [Скрипти](#скрипти)
8. [Ліцензія](#ліцензія)

## Вимоги

- Node.js v20.15.1+
- npm v10.7.0+
- Git (для клонування репозиторію)
- Ubuntu Server 24.04

## Встановлення

### Ручне встановлення та запуск

1. Клонуйте репозиторій:

  ```bash
  git clone https://github.com/roman-lakhnov/rest-sync-client-next-js-page-router.git
  ```

2.Перейдіть в директорію проєкту:

  ```bash
  cd rest-sync-client-next-js-page-router
  ```

3.Встановіть залежності:

  ```bash
  npm install
  ```

4.Перейменуйте файл .env.example в .env.local та заповніть відповідні
    параметри.

5.В разі налаштування взаємодіЇ з ШБО через протокол HTTPS перед першим запуском необхідно згенерувати самопідписний сертифікат за допомогою команди

  ```bash
  npm run gen-srt
  ```

6.Запустіть проєкт за допомогою команд

  ```bash
  npm run build
  ```

  ```bash
  npm start
  ```

7.Відкрийте в браузері посилання

  ```bash
  http://<your_server_ip>:3001
  ```

## Конфігурація

Створіть файл конфігурації `.env.local` в корені проєкту з наступним вмістом:

```bash
# Налаштування Next.js
PORT='3001'

# Налаштування вихідних запитів
# Протокол, який використовується для взаємодії з ШБО (https або http)
# Протокол https вимагає взаємної автентифікації клієнта з ШБО з використанням сертифікатів
PROTOCOL=https
# Хостнейм, FQDN або локальна IP-адреса ШБО
# можливі варіанти: 192.168.1.1, trembita.example.gov.ua
SECURITY_SERVER_IP=your_trembita_host # TREMBITA URL

PURPOSE_ID='5cbc1e1b-be44-4679-9214-3d4995b35d3a' # Ідентифікатор мети обробки персональних даних для взаємодії з сервісами, що використовують Підсистему моніторингу доступу до персональних даних системи Трембіта (ПМДПД). Може бути не заданим (закоментувати параметр), якщо обмін відбувається без використання цього ПМДПД.
INSTANCE_NAME='SEVDEIR-TEST' # Повний ідентифікатор клієнтської підсистеми Трембіти, що використовується для надсилання повідомлень-запитів
# xRoadInstance (SEVDEIR чи SEVDEIR-TEST)

# Налаштування Uxp-Client 
CLIENT_MEMBER_CLASS='GOV'
CLIENT_MEMBER_CODE='your_client_member_code'   # код ЄДРПОУ організації-клієнта
CLIENT_SUBSYSTEM=' your_client_subsystem_code'   # код підсистеми ШБО організації-клієнта, що буде використовуватись для запитів
IF_CLIENT_SAVE_ASIC='true'

# Налаштування Uxp-Service 
SERVICE_MEMBER_CLASS='GOV'
SERVICE_MEMBER_CODE='your_service_member_code'
SERVICE_SUBSYSTEM='your_service_subsystem_code'
SERVICE_CODE='your_service_code'
SERVICE_VERSION='your_service_version'

# Налаштування логування
LOG_LEVEL='debug' # Рівень логування (info, debug, error і т.д.)
LOG_DIRECTORY='./logs' # Директорія для збереження лог-файлів
ERROR_LOG_FILE_NAME='error.log' # Назва файлу для збереження логів помилок
COMBINED_LOG_FILE_NAME='combined.log' # Назва файлу для збереження об'єднаних логів

```

## Структура проєкту

Структура проєкту виглядає наступним чином:

```bash
rest-sync-client-next-js-page-router/
|-- asic                                    # Директорія для asic контейнерів
|-- certs                                   # Директорія для сертифікатів
|   |-- cert.pem                            # Файл сертифіката
|   |-- key.pem                             # Файл ключа
|-- components                              # Директорія з компонентами React
|   |-- DropdownComponent.js                # Компонент випадаючого списку
|   |-- FormComponent.js                    # Компонент форми
|   |-- NavBar.js                           # Компонент навігаційної панелі
|   |-- PaginationComponent.js              # Компонент пагінації
|-- logs                                    # Директорія для зберігання логів
|   |-- combined.log                        # Логи для об'єднаних повідомлень
|   |-- error.log                           # Логи для повідомлень про помилки
|-- node_modules**                          # Директорія з залежностями Node.js
|-- pages                                   # Директорія з сторінками Next.js
|   |-- api                                 # API маршрути
|   |   |-- download.js                     # API маршрут для завантаження
|   |   |-- list-asic.js                    # API маршрут для списку ASIC
|   |   |-- person.js                       # API маршрут для роботи з особами
|   |-- _app.js                             # Глобальний компонент застосунку
|   |-- add-person.js                       # Сторінка для додавання особи
|   |-- download-asic.js                    # Сторінка для завантаження ASIC
|   |-- find-person.js                      # Сторінка для пошуку особи
|   |-- index.js                            # Головна сторінка
|   |-- read-person.js                      # Сторінка для читання інформації про особу
|-- public                                  # Директорія для публічних файлів
|   |-- favicon.ico                         # Фавіконка сайту
|-- styles                                  # Директорія зі стилями
|   |-- globals.css                         # Глобальні стилі
|-- utils                                   # Директорія з утилітами
    |-- axiosBackend.js                     # Налаштування axios для бекенду
    |-- axiosFrontend.js                    # Налаштування axios для фронтенду
    |-- getUxpHeaders.js                    # Функція для отримання заголовків UXP
    |-- getUxpParams.js                     # Функція для отримання параметрів UXP
    |-- logger.js                           # Логування
    |-- middleware.js                       # Проміжні обробники
    |-- saveAsic.js                         # Збереження ASIC
|-- .env.local                              # Конфігурація середовища
|-- .gitignore                              # Ігнорування файлів Git
|-- certificates.js                         # Скрипт для генерації сертифікатів
|-- LICENSE                                 # Ліцензійний файл
|-- next.config.mjs                         # Конфігурація Next.js
|-- package.json                            # Залежності проєкту
|-- package-lock.json                       # Файл блокування залежностей
|-- README.md                               # Документація проєкту
```

## Використання

1. В разі налаштування взаємодіЇ з ШБО через протокол HTTPS необхідно на головній сторінці завантажити сертифікат безпеки та передати адміністратору ШБО для реєстрації клієнту.

2. Навігація між сторінками здійснюється за допомогою навігаційного меню у
   верхній частині екрану.

3. Додавання нової особи: перейдіть на сторінку "Додати особу" та заповніть
   форму, натиснувши кнопку "Надіслати форму і створити особу".

4. Пошук існуючої особи: перейдіть на сторінку "Знайти особу", введіть часткові
   дані особи у форму та натисніть кнопку "Знайти особу".

5. Перегляд і редагування даних особи: після пошуку особи на сторінці
   результатів, натисніть кнопку "Інфо" для переходу на сторінку з детальною
   інформацією про особу. Тут можна редагувати або видаляти запис про особу.

6. Завантаження ASiC файлу: перейдіть на сторінку "Завантажити ASIC", зі списку файлів відсортованих по часу запиту оберіть необхідний та натисніть кнопку "Download"

## Документація

### Опис роутів Next Api

- `/person` : Бекенд Next Api виконує перенаправлення запитів з фронтенду на сервіс(через ШБО).
  - `POST`: Створення нового запису про особу.
  - `GET`: Отримання списку осіб за параметрами запиту.
  - `PUT`: Оновлення осіб за атрибутом.
  - `DELETE`: Видалення осіб за атрибутом.
- `/list-asic`
  - `GET`: Отримання списку збережених asic контейнерів.
- `/download`
  - `GET`: Завантаження asic контейнерів або файлу сертифікату.

### Логування

- Здійснюється логування запитів та відповідей, а також помилок за допомогою Winston logger. Логи зберігаються у відповідних файлах згідно налаштувань середовища.

### Обробка помилок

- Помилки під час виконання запитів обробляються та логуються. Клієнт отримує відповідний статус та повідомлення про помилку.

### Залежності

- **axios**: Бібліотека HTTP-клієнта на основі промісів для Node.js та браузера.
- **bootstrap**: фреймворк HTML, CSS та JS для розробки адаптивних веб-сайтів.
- **cross-env**: Запускає команди в Node.js з настроюванням змінних середовища крос-платформово.
- **dotenv**: Завантажує змінні середовища з файлу .env в process.env.
- **morgan**: Middleware реєстрації запитів HTTP для Node.js.
- **next**: Фреймворк React для рендерингу на стороні сервера та створення статичних веб-сайтів.
- **react**: Бібліотека для створення користувацьких інтерфейсів.
- **react-bootstrap**: Компоненти Bootstrap, створені для React.
- **react-dom**: Пакет, що надає DOM-специфічні методи, які допомагають у створенні веб-додатків.
- **react-toastify**: Бібліотека для створення спливаючих повідомлень (тостів) у React.
- **selfsigned**: Генератор самопідписаних сертифікатів.
- **uuid**: Генератор унікальних ідентифікаторів.
- **winston**: Бібліотека для логування.

### Скрипти

- **gen-srt**: Генерація сертифікатів за допомогою скрипта `certificates.js`.
- **dev**: Запуск у режимі розробки з використанням змінних середовища з файлу `.env.local`.
- **start**: Запуск у режимі продакшн з використанням змінних середовища з файлу `.env.local`.
- **build**: Збірка проєкту.

## Ліцензія

Вебкліент на базі REST з Next.js та React був розроблений [Roman Lakhnov](mailto:lakhnov.roman@gmail.com).

Цей проєкт ліцензований під ліцензією GPL v3. Дивіться файл [LICENSE](LICENSE) для деталей.
